2021-08-14 15:51:01.441351: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-08-14 15:51:03.294453: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-08-14 15:51:03.298259: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcuda.so.1
2021-08-14 15:51:03.392602: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-08-14 15:51:03.393713: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:03:00.0 name: NVIDIA GeForce RTX 2080 Ti computeCapability: 7.5
coreClock: 1.545GHz coreCount: 68 deviceMemorySize: 10.76GiB deviceMemoryBandwidth: 573.69GiB/s
2021-08-14 15:51:03.393729: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-08-14 15:51:03.398055: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-08-14 15:51:03.398085: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-08-14 15:51:03.399153: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-08-14 15:51:03.399315: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-08-14 15:51:03.402966: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-08-14 15:51:03.403705: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-08-14 15:51:03.403804: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-08-14 15:51:03.403874: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-08-14 15:51:03.405023: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-08-14 15:51:03.406162: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2021-08-14 15:51:03.406733: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-08-14 15:51:03.406816: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-08-14 15:51:03.407962: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:03:00.0 name: NVIDIA GeForce RTX 2080 Ti computeCapability: 7.5
coreClock: 1.545GHz coreCount: 68 deviceMemorySize: 10.76GiB deviceMemoryBandwidth: 573.69GiB/s
2021-08-14 15:51:03.407978: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-08-14 15:51:03.408000: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-08-14 15:51:03.408009: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-08-14 15:51:03.408018: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-08-14 15:51:03.408027: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-08-14 15:51:03.408036: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-08-14 15:51:03.408059: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-08-14 15:51:03.408068: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-08-14 15:51:03.408110: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-08-14 15:51:03.409263: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-08-14 15:51:03.410326: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2021-08-14 15:51:03.410347: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-08-14 15:51:04.085082: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2021-08-14 15:51:04.085110: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2021-08-14 15:51:04.085117: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2021-08-14 15:51:04.085260: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-08-14 15:51:04.086712: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-08-14 15:51:04.088183: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-08-14 15:51:04.089637: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10073 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 2080 Ti, pci bus id: 0000:03:00.0, compute capability: 7.5)
2021-08-14 15:51:05.051757: W tensorflow/core/framework/cpu_allocator_impl.cc:80] Allocation of 411041792 exceeds 10% of free system memory.
2021-08-14 15:51:05.772009: W tensorflow/core/framework/cpu_allocator_impl.cc:80] Allocation of 67108864 exceeds 10% of free system memory.
2021-08-14 15:52:54.652722: W tensorflow/core/framework/cpu_allocator_impl.cc:80] Allocation of 2254602240 exceeds 10% of free system memory.
2021-08-14 15:52:57.423307: W tensorflow/core/framework/cpu_allocator_impl.cc:80] Allocation of 2254602240 exceeds 10% of free system memory.
2021-08-14 15:52:58.976592: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-08-14 15:52:59.832533: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-08-14 15:52:59.850752: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
Loading models...
Model: "Generator"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense (Dense)                (None, 7040)              183040    
_________________________________________________________________
batch_normalization (BatchNo (None, 7040)              28160     
_________________________________________________________________
re_lu (ReLU)                 (None, 7040)              0         
_________________________________________________________________
reshape (Reshape)            (None, 4, 11, 160)        0         
_________________________________________________________________
conv2d_transpose (Conv2DTran (None, 8, 22, 80)         320080    
_________________________________________________________________
batch_normalization_1 (Batch (None, 8, 22, 80)         320       
_________________________________________________________________
re_lu_1 (ReLU)               (None, 8, 22, 80)         0         
_________________________________________________________________
conv2d_transpose_1 (Conv2DTr (None, 16, 44, 40)        80040     
_________________________________________________________________
batch_normalization_2 (Batch (None, 16, 44, 40)        160       
_________________________________________________________________
re_lu_2 (ReLU)               (None, 16, 44, 40)        0         
_________________________________________________________________
conv2d_transpose_2 (Conv2DTr (None, 32, 88, 20)        20020     
_________________________________________________________________
batch_normalization_3 (Batch (None, 32, 88, 20)        80        
_________________________________________________________________
re_lu_3 (ReLU)               (None, 32, 88, 20)        0         
_________________________________________________________________
conv2d_transpose_3 (Conv2DTr (None, 64, 176, 3)        1503      
=================================================================
Total params: 633,403
Trainable params: 619,043
Non-trainable params: 14,360
_________________________________________________________________
Model: "Discriminator"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d (Conv2D)              (None, 32, 88, 20)        1520      
_________________________________________________________________
leaky_re_lu (LeakyReLU)      (None, 32, 88, 20)        0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 16, 44, 40)        20040     
_________________________________________________________________
batch_normalization_4 (Batch (None, 16, 44, 40)        160       
_________________________________________________________________
leaky_re_lu_1 (LeakyReLU)    (None, 16, 44, 40)        0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 8, 22, 80)         80080     
_________________________________________________________________
batch_normalization_5 (Batch (None, 8, 22, 80)         320       
_________________________________________________________________
leaky_re_lu_2 (LeakyReLU)    (None, 8, 22, 80)         0         
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 4, 11, 160)        320160    
_________________________________________________________________
batch_normalization_6 (Batch (None, 4, 11, 160)        640       
_________________________________________________________________
leaky_re_lu_3 (LeakyReLU)    (None, 4, 11, 160)        0         
_________________________________________________________________
reshape_1 (Reshape)          (None, 7040, 1)           0         
_________________________________________________________________
flatten (Flatten)            (None, 7040)              0         
_________________________________________________________________
mini_batch_discrimination (M (None, 7200)              3379680   
_________________________________________________________________
dense_1 (Dense)              (None, 1)                 7201      
=================================================================
Total params: 3,809,801
Trainable params: 3,809,241
Non-trainable params: 560
_________________________________________________________________
All models loaded.
Glasses dataset ready.
Perform special training:
Attack training epoch 1.
Traceback (most recent call last):
  File "demo1.py", line 56, in <module>
    g_opt, d_opt, obj_d, obj_f = attacks.do_attack_training_step(dap, gen_model, dis_model, face_model, img_path,
  File "/home/kubon/MyGit/agns-port/agns-py/src/attacks.py", line 232, in do_attack_training_step
    real_output = dis(real_glasses_a, training=True)
  File "/home/kubon/env/lib/python3.8/site-packages/tensorflow/python/keras/engine/base_layer.py", line 1012, in __call__
    outputs = call_fn(inputs, *args, **kwargs)
  File "/home/kubon/env/lib/python3.8/site-packages/tensorflow/python/keras/engine/sequential.py", line 375, in call
    return super(Sequential, self).call(inputs, training=training, mask=mask)
  File "/home/kubon/env/lib/python3.8/site-packages/tensorflow/python/keras/engine/functional.py", line 424, in call
    return self._run_internal_graph(
  File "/home/kubon/env/lib/python3.8/site-packages/tensorflow/python/keras/engine/functional.py", line 560, in _run_internal_graph
    outputs = node.layer(*args, **kwargs)
  File "/home/kubon/env/lib/python3.8/site-packages/tensorflow/python/keras/engine/base_layer.py", line 998, in __call__
    input_spec.assert_input_compatibility(self.input_spec, inputs, self.name)
  File "/home/kubon/env/lib/python3.8/site-packages/tensorflow/python/keras/engine/input_spec.py", line 219, in assert_input_compatibility
    raise ValueError('Input ' + str(input_index) + ' of layer ' +
ValueError: Input 0 of layer batch_normalization_4 is incompatible with the layer: expected ndim=4, found ndim=5. Full shape received: (1, 32, 16, 44, 40)
